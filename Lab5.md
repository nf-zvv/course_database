# Лабораторная работа №5

## Задание

Реализовать методы для CRUD операций из ЛР №4:

1. Получение списка всех записей;
2. Получение списка всех зависимых записей (один-ко-многим);
3. Получение одной записи по первичному ключу;
4. Сохранение одной записи;
5. Обновление одной записи;
6. Удаление одной записи.

## Пояснения

На примере языка программирования PHP в процедурном стиле. Для выполнения задания можно выбрать другой язык программирования, например, Python.

PHP поддерживает работу с СУБД MySQL, для этого используется расширение `mysqli`.

### Работа с СУБД в PHP-сценарии состоит из нескольких шагов

1. Установить подключение к серверу СУБД, передав необходимые параметры: адрес, логин, пароль.
2. Убедиться, что подключение прошло успешно: сервер СУБД доступен, логин и пароль верные.
3. Сформировать правильный SQL запрос (например, на чтение данных из таблицы).
4. Убедиться, что запрос был выполнен успешно.
5. Получить результат от СУБД в виде массива из записей.
6. Использовать полученные записи.
7. Закрыть соединение с базой данных.

#### Подключение к серверу СУБД и проверка соединения

В PHP это делается с помощью стандартной функции `mysqli_connect()`. Функция возвращает результат — ресурс соединения. Данный ресурс используется для всех следующих операций с БД.

Базовый синтаксис функции `mysqli_connect()`:

```php
mysqli_connect(<адрес сервера>, <имя пользователя>, <пароль>, <имя базы данных>);
```

После соединения с СУБД необходимо выполнить проверку:

```php
<?php
$link = mysqli_connect("localhost", "root", "");

if ($link == false){
    print("Ошибка: Невозможно подключиться к MySQL " . mysqli_connect_error());
}
else {
    print("Соединение установлено успешно");
}
?>
```

#### Добавление записи

Для добавления записи необходимо сформировать корректный SQL-запрос, а затем выполнить его путём передачи этого запроса в функцию `mysqli_query()`.

```php
$link = mysqli_connect("localhost", "root", "");

$sql = 'INSERT INTO Users (username, email) VALUES ("Tom", "tom@example.com")';
$result = mysqli_query($link, $sql);

if ($result == false) {
    print("Произошла ошибка при выполнении запроса");
}
```

Первым параметром для функции `mysqli_query()` передаётся ресурс подключения, полученный от функции `mysqli_connect()`, вторым параметром следует строка с SQL-запросом.

Для получения идентификатора добавленной записи используется функция `mysqli_insert_id()`. Она принимает единственный аргумент - ресурс соединения, а возвращает идентификатор последней добавленной записи.

#### Чтение записей

Для чтения записей используется SQL-запрос, содержащий `SELECT` выражение.

```php
$sql = 'SELECT id, username FROM Users';

$result = mysqli_query($link, $sql);

while ($row = mysqli_fetch_array($result)) {
    print("Пользователь: " . $row['username'] . "; Идентификатор: . " . $row['id'] . "<br>");
```

Функция `mysqli_query()` возвращает ссылку на результаты запроса.

Чтобы получить действительные данные, то есть записи из таблицы, далее следует использовать функцию - `mysqli_fetch_array()`.

Для получения всех записей в виде двумерного массива необходимо использовать функцию `mysqli_fetch_all($res, MYSQLI_ASSOC)`.

Пример:

```php
$sql = 'SELECT id, username FROM cities';
$result = mysqli_query($link, $sql);

$rows = mysqli_fetch_all($result, MYSQLI_ASSOC)

foreach ($rows as $row) {
    print("Пользователь: " . $row['username'] . "; Идентификатор: . " . $row['id'] . "<br>");
}
```

#### Закрытие соединения

Для закрытия соединения применяется функция `mysqli_close()`, которая в качестве параметра принимает ранее созданный объект подключения.
